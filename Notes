Code refactoring
----------------

+ accounts.py line 648 remove redundant setMovie statement
+ adjust web view spacing and margins for widgets (relative to window borders)
+ check if QEvent.DynamicPropertyChange happens after the property changed

+ do not kill greenlets but interrupt commands instead (sipsimple)
- refactor how models/dialogs/windows are created and where are they kept
- GoogleContactManager.enable_captcha should be decorated to run in the gui thread
- GoogleContactManager._set_captcha_image should be decorated to run in the gui thread
- _authorize_google_account from google dialog needs refactoring
- saving settings should be probably done in an auxiliary thread not the green thread
- rename main_window.google_contacts_dialog to something else

Issues
------

- in Smooth Operator check if the src attribute is atill needed in elements
  that have the x-color class. there used to be a rule that matched elements
  with an x-color class which also had a src attribute pointing to a
  particular image, but since that was removed, no other rule matching
  an element with the x-color class cares for the src attribute. check if
  the src attribute on a span tag means anything, if not it can probably be
  safely removed from message.html and message_continuation.html
- don't show selected audio device on the incoming dialog for chat
- reconsider the busy button on the incoming dialog (replace with ignore?)
- if I have an audio(+chat) call and make another atempt to establish a call
  (doesn't matter what kind), but cancel it, the hold button is left disabled
- when a session is closed the chat window shows: "Disconnected: Connection
  was closed cleanly", but when calling oneself and a loop is detected is
  only says "Disconnected". It should actually only say Disconnected when
  the connection is ended normally and show the failure reason if not.
  Also when a connection is ended voluntarily it should not care if there
  is a failure while stopping the streams.
- 1 session active and aother on hold, it beeps every 15 seconds.
- new problem introduced: because we create streams early, now the session
  tiles show the stream icons before we even attempt to connect.
- decide what to do about having keyboard shortcuts for hold/hangup in the
  chat window (list may not be visible all the time and here we also
  differentiate between hangup and delete session)
- modify the conferencing code to use move inside the model instead of
  remove+add, to avoid/minimize selection changes
- move tray icon from the main window to Blink?
- find out what messes up the selection while dragging a contact into a
  conference if ignore_selection_changes is not set.
- find a way to not have a chat session item selected when we press over
  the close/expand indicators on the session tile.
- if I have an audio only session and I add chat, it rings using the audio
  outgoing ringtone. to fix maybe add a proposed_streams to BlinkSession
  and put the proposed streams in there until they are accepted. this way
  we know what is proposed even when handling BlinkSessionDidChangeState
- there are session transitions that do not change the state (for example
  a stream that is removed, either by local or remote, never switches the
  state to sent/received_proposal and back. this means that one cannot
  rely on BlinkSessionDidChangeState alone to handle session transitions,
  but instead needs to also listed to BlinkSessionDidRemoveStream.
- If an audio+chat session is on hold and the audio stream is removed while
  on hold, it remains showing it being on hold until a new audio stream is
  added. (this is not true anymore. it only shows on hold until it is
  removed from the audio session list. maybe we should reset the active flag
  early?)
- I got an incoming call and the contact was found as a google contact, but
  in history I have no name and the original uri. if I dial back, it doesn't
  find the contact and says number@domain for the name.
- is the ringtone for incoming chat only sessions appropriate?
- not sure about passing a Contact object to the session instead of
  contact.settings.
- the DummyContact should follow the other contact APIs (have an id, ...)
  in order to be usable in their place.
- have a contact.default_streams that returns a list of StreamDescription?
- have a contact.account property that returns the best account for outgoing?

Ideas:
------

- On sessionAboutToBeRemoved, we should preselect the next item we want
  selected, so when it is actually removed, we do not flip.flop the
  selection (may also need the ignore_selection_changes flag to be set)
- check the selectionCommand from the audio session model. it may be also
  useful for the chat session model to avoid selection on mouse press
  events (make it only happen on mouse release events).


- exceptions:


Investigate this exception:

sip:nwpsefvl@10.0.0.1:52067 52067
sip:nwpsefvl@10.0.0.1:52067 52067
sip:nwpsefvl@10.0.0.1;transport=tcp None
Traceback (most recent call last):
  File "/usr/lib/python2.5/site-packages/twisted/internet/base.py", line 778, in runUntilCurrent
    call.func(*call.args, **call.kw)
  File "/usr/lib/pymodules/python2.5/eventlet/hubs/twistedr.py", line 158, in call_if_greenlet_alive
    return func(*args1, **kwargs1)
  File "/usr/lib/pymodules/python2.5/eventlet/proc.py", line 571, in _run
    result = function(*args, **kwargs)
  File "/home/dan/work/voip/python-sipsimple/sipsimple/account.py", line 683, in _handle_commands
    handler(command)
  File "/home/dan/work/voip/python-sipsimple/sipsimple/account.py", line 720, in _CH_register
    txtRecord=bonjour.TXTRecord(items=txtdata))
  File "/home/dan/work/voip/blink-qt/sipsimple/bonjour.py", line 1125, in DNSServiceRegister
TypeError: an integer is required

Presence
--------

- Is picking the most recent timestamp a good winning method?
- Calculate user idleness
- Add a GUI element for the offline note
- Delete own icon if we don't get anything back from XCAP?
- Unify settings for inbound and outbound presence

